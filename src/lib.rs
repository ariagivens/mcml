mod assign_homes;
mod datapack;
mod lex;
mod linearize;
mod parse;
mod runtime;
mod select_commands;
mod uniquify;
mod utility;
mod var;

use anyhow::Result;
use assign_homes::assign_homes;
pub use datapack::Datapack;
use lex::lex;
use linearize::linearize;
use parse::parse;
use select_commands::select_commands;
use uniquify::uniquify;

pub fn compile(source: &str) -> Result<Datapack> {
    let functions = select_commands(assign_homes(linearize(uniquify(parse(lex(source)?)?))))?;

    Ok(Datapack {
        description: "Datapack generated by MCML".to_owned(),
        pack_format: 18,
        functions,
    })
}
